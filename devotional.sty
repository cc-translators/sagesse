\ProvidesPackage{devotional}

% Define useful aliases
\newcommand{\dvmonth}[1]{\chapter{#1}\cleardoublepage}
\newcommand{\dvday}[1]{\section{#1}}

% bibleref settings
\usepackage{bibleref-french-colombe}

% set paragraphs
\setlength{\parindent}{5mm}
\setlength{\parskip}{1ex plus 0.5ex minus 0.2ex}

% no headings, no page numbers
\pagestyle{empty}
% also for chapter pages
\renewcommand*{\chapterpagestyle}{empty}

% font
\usepackage[T1]{fontenc}
\usepackage{lmodern}

% setting lettrines
\usepackage{type1cm} % scalable fonts
\usepackage{lettrine}
\usepackage{xcolor}
\renewcommand{\LettrineFontHook}{\color[gray]{0.5}}
\newcommand{\dvlettrine}[3][]{
   \lettrine[lines=2,lhang=0.33,loversize=0.25,#1]{#2}{#3}
}

% Make day number in month, in french
\usepackage{ifthen}
\newcommand{\makedate}[1]{
  \ifthenelse{\equal{#1}{1}}{1\up{er}}{#1}
}

% Define \chaphead to be used in section headings
\let\oldchapter\chapter
\newcommand\temphead{}
\newcommand\chaphead{}
\renewcommand\chapter[2][\temphead]{%
    \renewcommand\temphead{#2}%
    \renewcommand\chaphead{#2}%
    \oldchapter[#1]{#2}}

% Tune chapter headings
\usepackage{titlesec}
\titleformat{\chapter}[block]
  {\scshape\Huge}
  {}{10pt}
  {\begin{center}}
  [\end{center}]

% Make tabs for sections
\usepackage{tikz}

%\def\monthtabpos#1%
%  {\ifthenelse{#1<7}
%     {\dimexpr \numexpr -3*#1 \relax cm}
%     {\dimexpr \numexpr -3*(#1-6) \relax cm}
%  }

\newcommand{\monthtab}[2]{
  \shorthandoff{;}
  \begin{tikzpicture}[remember picture,overlay]
    \node[yshift={-3*(mod(#2-1,6)+1)*1cm},xshift=-0.5cm] at (current page.north east) {
      \tikz\shade[shading=axis,bottom color=white,top color=gray!50,shading angle=-90] 
        (0,0) rectangle (1cm,3cm) node[rotate=90,pos=0.5] {\Large\scshape #1};
    };
  \end{tikzpicture}
}

\newcommand{\secstyle}{\scshape\Huge}

% Tune section headings
\renewcommand\thesection{\arabic{section}}
\titleformat{name=\section,page=even}[display]
  {\newpage\secstyle} % format
  {\large\makedate{\thesection}~\chaphead} % label
  {10pt} %sep
  {\vspace{-5mm}\filcenter\textls[-35]} %before
\titleformat{name=\section,page=odd}[display]
  {\newpage\secstyle} % format
  {\large\makedate{\thesection}~\chaphead} % label
  {10pt} %sep
  {\vspace{-5mm}\filcenter\textls[-50]} %before
  [\monthtab{\chaphead}{\arabic{chapter}}\vspace{-\baselineskip}] % after
\titlespacing{\section}{0pt}{*}{*-2}


% opening quote
\newcommand{\dvquote}[2]{
  \begin{center}\parbox{90mm}{
    \begin{center}
    \begin{itshape}#1\end{itshape}\\
    -- \textsc{#2}
    \end{center}
  }\end{center}\vspace{-5mm}}

% central quote
\usepackage{fancybox}
\newcommand{\dvbox}[1]{
  \begin{center}\doublebox{
    \parbox{10cm}{
      \vspace{3mm}
        \begin{center}
          \parbox{9cm}{\textsc{#1}}
        \end{center}
      \vspace{3mm}
    }
  }\end{center}}


% ending prayer
\newcommand{\dvprayer}[2]{
  \begin{center}\parbox{4in}{
    \begin{center}
    \begin{itshape}#1\end{itshape}\\
    \scshape#2
    \end{center}
  }\end{center}}

% Rule sep
\usepackage{fourier-orns}
\newcommand{\dvrule}{
  \begin{center}
    \rule{1cm}{.3pt}~~\floweroneleft\floweroneright~~\rule{1cm}{.3pt}
  \end{center}
}


